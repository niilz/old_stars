(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[158],{154:e=>{e.exports={Header:"Header_Header__r28vo",logo:"Header_logo__ITeVo",headerStripes:"Header_headerStripes__uGMbu",title:"Header_title__llmgH"}},1002:e=>{e.exports={Message:"Message_Message__RY7Dc",error:"Message_error__oQdtH",info:"Message_info__ULI_R",none:"Message_none__9v8Rt"}},1490:e=>{e.exports={AppLogo:"Logo_AppLogo__n42AC",starotate:"Logo_starotate__yepxx"}},1540:e=>{e.exports={Btn:"Button_Btn__tQLCR"}},1634:e=>{e.exports={Main:"Main_Main__cpCi5",headerStripes:"Main_headerStripes__gOoXo",title:"Main_title__QDklA",logo:"Main_logo__1tkZI"}},2091:e=>{e.exports={warningWrapper:"WaterRoundWarning_warningWrapper__6Uygi",warning:"WaterRoundWarning_warning__S9NfG"}},2158:(e,t,s)=>{"use strict";s.r(t),s.d(t,{AppCtx:()=>eU,default:()=>eT});var n=s(5155),r=s(2115);let o="old-star-user-session";var i=function(e){return e.GET="GET",e.POST="POST",e.DELETE="DELETE",e.HEAD="HEAD",e.OPTIONS="OPTIONS",e}({}),a=function(e){return e[e.LoggedInClub=0]="LoggedInClub",e[e.LoggedInAdmin=1]="LoggedInAdmin",e[e.LoggedInUser=2]="LoggedInUser",e[e.LoggedOut=3]="LoggedOut",e[e.LoginError=4]="LoginError",e}({}),l=function(e){return e[e.Club=0]="Club",e[e.User=1]="User",e[e.Admin=2]="Admin",e[e.None=3]="None",e}({}),u=s(1002),c=s.n(u),d=function(e){return e.ERR="error",e.INFO="info",e.NONE="none",e}({});function h(e){return(0,n.jsx)("p",{className:`${c().Message} ${c()[e.type]}`,children:e.msg})}let g=new Headers;async function _(e,t,s,n){n&&g.set(`${o}`,n);let r={method:e,headers:g,mode:"cors",cache:"default",credentials:"include"};e===i.POST&&(r.body=s);let a=await fetch(`https://niilz.de/${t}`,r);return await a.json()}function x(e){let{Ok:t}=e,{Err:s}=e;if(s)throw`Ooops... ${s}`;return t}g.set("Accept","application/json"),g.set("Content-Type","application/json");class m{static async loginUser(e){return x(await _(i.POST,"login",JSON.stringify(e)))}}async function j(e){return x(await _(i.POST,"register",JSON.stringify(e)))}async function p(){return _(i.GET,"all","")}async function C(e){return _(i.GET,"start","",e)}async function y(){return _(i.GET,"logout","")}var L=s(1540),w=s.n(L);function b(e){return(0,n.jsx)("button",{className:`${w().Btn} ${e.styles}`,onClick:e.callback,children:e.text})}var v=s(8976),N=s.n(v),f=function(e){return e[e.ClubLogin=0]="ClubLogin",e[e.UserLogin=1]="UserLogin",e[e.AdminLogin=2]="AdminLogin",e[e.Playground=3]="Playground",e[e.AdminConsole=4]="AdminConsole",e[e.Histories=5]="Histories",e[e.OneHistory=6]="OneHistory",e}({});let A=r.createContext({addUser:e=>{},setSessionUser:e=>{}});a.LoggedOut;let E=r.createContext({activeView:f.ClubLogin,setActiveView:e=>{}}),U=r.createContext({currentError:"",setCurrentError:e=>{}}),T=r.createContext({selectedHistory:[],setSelectedHistory:e=>{}});function S(e){var t;let{loginType:s,setLoginType:i}=(0,r.useContext)(eU),{setSessionUser:u}=(0,r.useContext)(A),[c,h]=(0,r.useState)(""),[g,_]=(0,r.useState)(""),x=async()=>{try{let t=await j({name:c,pwd:g});e.onRegister(t),h(""),_("")}catch(t){e.onError(d.ERR,t)}};return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("form",{onSubmit:D,className:`${N().RegisterLoginForm} ${s===l.User?e.styles:""}`,children:[s===l.User&&(0,n.jsx)("input",{type:"text",placeholder:"user-name",value:c,onChange:e=>h(e.target.value)}),(0,n.jsx)("input",{type:"password",value:g,placeholder:(t=s,`${l[t]} Password`),onChange:e=>_(e.target.value)}),(0,n.jsx)(b,{text:"Login",styles:N().registerBtn,callback:()=>{m.loginUser({name:c||function(e){switch(e){case l.Club:return"club";case l.Admin:return"admin!";default:throw"Cannot evaluate the Login Name if the userName is undefined"}}(s),pwd:g}).then(t=>{let n=function(e){switch(e){case l.User:return a.LoggedInUser;case l.Club:return a.LoggedInClub;case l.Admin:return a.LoggedInAdmin;default:throw`Unhandled loginTyp: ${e}. Cannot evaluate a LoginState`}}(s);e.onLogin(n),h(""),_(""),i(function(e){switch(e){case l.Club:return l.User;case l.User:case l.Admin:return l.None;default:throw"Unsupported LoginType-State"}}(s)),s===l.User&&(u(t.user),window.localStorage.setItem(o,t.sessionId))}).catch(t=>e.onError(d.ERR,t))}}),s===l.User&&(0,n.jsx)(b,{text:"Register",styles:N().registerBtn,callback:x})]})})}function D(e){e.preventDefault()}var H=s(7014),O=s.n(H);function k(e){let[t,s]=(0,r.useState)(""),[o,i]=(0,r.useState)(d.NONE),{addUser:l}=(0,r.useContext)(A);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(h,{msg:t,type:o}),(0,n.jsx)(S,{...e,onRegister:e=>{s("Registration was successful"),i(d.INFO),l(e)},onLogin:t=>{t!==a.LoginError&&(s(""),i(d.NONE)),e.onLogin(t)},onError:(e,t)=>{s(t),i(e)},styles:O().LoginForm})]})}var P=s(1634),R=s.n(P),I=s(1490),M=s.n(I);function $(e){return(0,n.jsx)("div",{className:`${M().AppLogo} ${e.styles}`,children:"⭐"})}var V=s(154),B=s.n(V);function F(e){let{appHeight:t}=(0,r.useContext)(eU);return(0,n.jsxs)("header",{className:B().Header,children:[e.showLogo?(0,n.jsx)($,{styles:B().logo}):null,(0,n.jsx)("div",{className:`${B().headerStripes} ${e.styles?e.styles.headerStripes:""}`,children:(0,n.jsx)("h1",{className:`${B().title} ${e.styles?e.styles.title:""}`,children:"Old-Stars App"})})]})}var W=s(9231),G=s.n(W);function z(e){let{setActiveView:t}=(0,r.useContext)(E);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(F,{showLogo:!1,styles:{headerStripes:G().headerStripes,title:G().title}}),(0,n.jsx)($,{styles:G().logo}),(0,n.jsx)(k,{onLogin:()=>t(f.UserLogin)})]})}var X=s(3774),Q=s.n(X);function J(){let{setActiveView:e}=(0,r.useContext)(E);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(F,{showLogo:!1,styles:{headerStripes:Q().headerStripes,title:Q().title}}),(0,n.jsx)($,{styles:Q().logo}),(0,n.jsx)(k,{onLogin:()=>e(f.Playground)})]})}var q=s(4622),K=s.n(q);function Z(e){let{appHeight:t}=(0,r.useContext)(eU);return(0,n.jsx)("div",{className:K().Modal,style:{height:t},children:e.children})}var Y=s(9458),ee=s.n(Y);function et(e){return(0,n.jsxs)("tr",{className:ee().itemContent,children:[(0,n.jsx)("td",{children:(0,n.jsx)("div",{className:ee().userData,children:e.user.name})}),(0,n.jsx)("td",{className:ee().count,children:e.user.beerCount}),(0,n.jsx)("td",{className:ee().count,children:e.user.shotCount}),(0,n.jsx)("td",{className:ee().count,children:e.user.otherCount}),(0,n.jsx)("td",{className:ee().count,children:e.user.waterCount}),e.isEditable?(0,n.jsx)("td",{children:(0,n.jsx)("button",{className:ee().delBtn,onClick:e.deleteGotClicked,children:"❌"})}):null]})}var es=s(3911),en=s.n(es);function er(e){return(0,n.jsx)("div",{className:en().TableArea,children:(0,n.jsxs)("table",{className:en().UserList,children:[(0,n.jsx)("thead",{className:en().Thead,children:(0,n.jsxs)("tr",{className:en().Tr,children:[(0,n.jsx)("th",{className:en().Th}),(0,n.jsx)("th",{className:en().Th,children:"\uD83C\uDF7A"}),(0,n.jsx)("th",{className:en().Th,children:"\uD83E\uDD43"}),(0,n.jsx)("th",{className:en().Th,children:"\uD83E\uDD64"}),(0,n.jsx)("th",{className:en().Th,children:"\uD83D\uDEB0"})]})}),(0,n.jsx)("tbody",{children:e.users.map(t=>(0,n.jsx)(et,{id:t.id,user:t,isEditable:e.isEditable,deleteGotClicked:()=>e.onDelete?e.onDelete(t.id):null},t.id))})]})})}var eo=s(2263),ei=s.n(eo);function ea(e){let t=async t=>{let s=x(await _(i.GET,`${t}/${e.user.id}`,""));e.onUserUpdate(s)};return(0,n.jsxs)("div",{className:ei().User,children:[(0,n.jsx)("p",{className:ei().name,children:e.user.name}),(0,n.jsxs)("div",{className:ei().statsPanel,children:[(0,n.jsxs)("div",{className:ei().icons,children:[(0,n.jsx)("button",{onClick:()=>t("beer"),className:ei().beer,children:"\uD83C\uDF7A"}),(0,n.jsx)("button",{onClick:()=>t("shot"),className:ei().shots,children:"\uD83E\uDD43"}),(0,n.jsx)("button",{onClick:()=>t("other"),className:ei().other,children:"\uD83E\uDD64"}),(0,n.jsx)("button",{onClick:()=>t("water"),className:ei().water,children:"\uD83D\uDEB0"})]}),(0,n.jsxs)("div",{className:ei().stats,children:[(0,n.jsx)("p",{className:ei().count,children:e.user.beerCount}),(0,n.jsx)("p",{className:ei().count,children:e.user.shotCount}),(0,n.jsx)("p",{className:ei().count,children:e.user.otherCount}),(0,n.jsx)("p",{className:ei().count,children:e.user.waterCount})]})]})]})}var el=s(2091),eu=s.n(el);function ec(e){let t=async()=>{let t=x(await _(i.GET,`water/${e.userId}`,""));e.onWaterConsumed(t)};return(0,n.jsxs)("div",{className:eu().warningWrapper,children:[(0,n.jsx)("p",{className:eu().warning,children:"Du musst eine Wasserrunde trinken"}),(0,n.jsx)(b,{text:"Wasser getrunken",styles:"",callback:t})]})}class ed{static #e=this.MAX_ALC_TO_WATER_RATIO=3;constructor(e){this.id=e.id,this.name=e.name,this.role=e.role,this.pwd=e.pwd,this.beerCount=e.beerCount,this.shotCount=e.shotCount,this.otherCount=e.otherCount,this.waterCount=e.waterCount}needsWaterRound(){let e=this.beerCount+this.shotCount;return 0!==e&&(0===this.waterCount?e>ed.MAX_ALC_TO_WATER_RATIO:e/this.waterCount>ed.MAX_ALC_TO_WATER_RATIO)}}var eh=s(4840),eg=s.n(eh);function e_(e){let t=new ed(e.user);return(0,n.jsxs)(n.Fragment,{children:[t.needsWaterRound()&&(0,n.jsx)(Z,{children:(0,n.jsx)(ec,{userId:e.user.id,onWaterConsumed:e.onUserUpdate})}),(0,n.jsxs)("div",{className:eg().Playground,children:[(0,n.jsx)(F,{showLogo:!0}),(0,n.jsx)(ea,{user:e.user,onUserUpdate:e.onUserUpdate}),(0,n.jsx)(er,{users:e.users,isEditable:!1}),(0,n.jsxs)("div",{className:eg().buttons,children:[(0,n.jsx)(b,{text:"logout",styles:eg().Btn,callback:e.logout}),(0,n.jsx)(b,{text:"\uD83D\uDD04",styles:eg().refresh,callback:e.onRefresh})]}),(0,n.jsx)(b,{text:"archive",styles:eg().Btn,callback:e.onHistories}),(0,n.jsx)(b,{text:"admin",styles:eg().Btn,callback:e.openAdminLogin})]})]})}var ex=s(7737),em=s.n(ex);function ej(e){let{setActiveView:t}=(0,r.useContext)(E);return(0,n.jsxs)("div",{className:em().AdminConsole,children:[(0,n.jsx)(F,{showLogo:!0}),(0,n.jsx)(er,{users:e.users,isEditable:!0,onDelete:t=>{let s=_(i.DELETE,`delete/${t}`,"");e.onDelete(s)}}),(0,n.jsx)(b,{text:"historize",styles:em().Btn,callback:()=>{let t=_(i.GET,"historize","");e.onHistorize(t)}}),(0,n.jsx)(b,{text:"Home",styles:em().Btn,callback:()=>t(f.Playground)})]})}function ep(e){let t=new Date(1e3*e.secs_since_epoch);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString()}}var eC=s(7768),ey=s.n(eC);function eL(e){let{setActiveView:t}=(0,r.useContext)(E),{date:s,time:o}=e.dateAndTime;return(0,n.jsxs)("div",{className:ey().OneHistory,children:[(0,n.jsx)(F,{showLogo:!0}),(0,n.jsx)("h1",{className:ey().H1,children:"Historisches Ergebnis"}),(0,n.jsx)("h2",{className:ey().H2,children:`${s} / ${o}`}),(0,n.jsx)(er,{users:e.users,isEditable:!1}),(0,n.jsx)(b,{text:"back",styles:ey().Btn,callback:()=>t(f.Histories)}),(0,n.jsx)(b,{text:"Home",styles:ey().Btn,callback:()=>t(f.Playground)})]})}var ew=s(2564),eb=s.n(ew);function ev(e){let{setActiveView:t}=(0,r.useContext)(E),{setSelectedHistory:s}=(0,r.useContext)(T);return(0,n.jsxs)("div",{className:eb().ArchiveView,children:[(0,n.jsx)(F,{showLogo:!0}),(0,n.jsx)("ol",{className:eb().ArchiveList,children:Array.from(e.historyDays.keys()).map((r,o)=>{let{date:i,time:a}=JSON.parse(r);return(0,n.jsx)("li",{id:`history-${o}`,children:(0,n.jsx)(b,{styles:eb().archiveButton,text:`Beendet am ${i} um ${a}`,callback:()=>{s(e.historyDays.get(r)||[]),t(f.OneHistory)}})},`history-${o}`)})}),(0,n.jsx)(b,{styles:"",text:"home",callback:()=>t(f.Playground)})]})}function eN(){let[e,t]=(0,r.useState)([]),[s,a]=(0,r.useState)(null),[u,c]=(0,r.useState)([]),[d,h]=(0,r.useState)([]),{setLoginType:g,setAdminLoginOpen:m}=(0,r.useContext)(eU),{activeView:j,setActiveView:L}=(0,r.useContext)(E),{setCurrentError:w}=(0,r.useContext)(U),b=async()=>{try{let e=await p(),s=x(e);t(s)}catch(e){L(f.ClubLogin),console.error(`Loading users failed: ${e}`),w("loading users failed")}};(0,r.useEffect)(()=>{b()},[]),(0,r.useEffect)(()=>{let e=async e=>{let t=await C(e);if(t.Err)console.log(`Session login did not work. Err: ${t.Err}. Clearing token`),window.localStorage.removeItem(o);else{console.log(`got attachResponse: ${t}`);let e=x(t);e&&(a(e),L(f.Playground))}},t=window.localStorage.getItem(o);t&&e(t).catch(e=>{console.error(`Could not attach session: ${e}`),w("Attaching session failed")})},[]);let v=async e=>{x(await e),b()},N=async()=>{await y()&&(L(f.UserLogin),g(l.User),a(null),window.localStorage.removeItem(o))},S=async()=>{let e=x(await p());t(e),s&&a(e.filter(e=>e.id===s.id)[0])},D=async e=>{let t=await e;console.log(`Histories: ${t}`)},H=async()=>{c(x(await _(i.GET,"histories",""))),L(f.Histories)};return(0,n.jsx)("div",{className:R().Main,children:(0,n.jsxs)(A.Provider,{value:{addUser:s=>{t([...e,s])},setSessionUser:a},children:[j===f.ClubLogin&&(0,n.jsx)(z,{}),j===f.UserLogin&&(0,n.jsx)(J,{}),j===f.Playground&&s&&(0,n.jsx)(e_,{user:s,users:e,logout:N,openAdminLogin:()=>{g(l.Admin),m(!0)},onUserUpdate:s=>{t(e.map(e=>e.id===s.id?s:e)),a(s)},onHistories:H,onRefresh:S}),j===f.AdminConsole&&(0,n.jsx)(ej,{users:e,onDelete:v,onHistorize:D}),(0,n.jsxs)(T.Provider,{value:{selectedHistory:d,setSelectedHistory:h},children:[j===f.Histories&&(0,n.jsx)(ev,{historyDays:u.reduce((e,t)=>{let s=JSON.stringify(ep(t.timestamp)),n=e.get(s);return n?n.push(t):e.set(s,[t]),e},new Map)}),j===f.OneHistory&&(0,n.jsx)(eL,{dateAndTime:ep(d[0].timestamp),users:d.map(e=>({id:e.id,name:e.userName,role:null,pwd:"",beerCount:e.beerCount,shotCount:e.shotCount,otherCount:e.otherCount,waterCount:e.waterCount}))})]})]})})}s(3905);var ef=s(2711),eA=s.n(ef);function eE(){let{currentError:e}=(0,r.useContext)(U);return(0,n.jsx)("div",{className:eA().error,children:(0,n.jsx)("p",{children:e})})}let eU=r.createContext({isAdminLoginOpen:!1,setAdminLoginOpen:e=>{},loginType:l.Club,setLoginType:e=>{},appHeight:0}),eT=function(){let[e,t]=(0,r.useState)(!1),[s,o]=(0,r.useState)(l.Club),[i,u]=(0,r.useState)(window.innerHeight),[c,d]=(0,r.useState)(f.ClubLogin),[h,g]=(0,r.useState)("");return(0,n.jsx)(eU.Provider,{value:{isAdminLoginOpen:e,setAdminLoginOpen:t,loginType:s,setLoginType:o,appHeight:i},children:(0,n.jsx)(U.Provider,{value:{currentError:h,setCurrentError:g},children:(0,n.jsx)(E.Provider,{value:{activeView:c,setActiveView:d},children:(0,n.jsxs)("div",{className:"App",style:{height:i},children:[(0,n.jsx)(eN,{}),(0,n.jsx)(eE,{}),e&&(0,n.jsx)(Z,{children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(k,{onLogin:e=>{if(e!==a.LoggedInAdmin)throw"Only Admin should be able to log in as admin";d(f.AdminConsole),t(!1)}}),(0,n.jsx)(b,{text:"cancel",callback:()=>t(!1),styles:""})]})})]})})})})}},2263:e=>{e.exports={User:"UserView_User__s0Lxk",statsPanel:"UserView_statsPanel__rvhge",icons:"UserView_icons__H88O8",stats:"UserView_stats__Mo182",beer:"UserView_beer__aBxz5",other:"UserView_other__i7pF5"}},2564:e=>{e.exports={ArchiveView:"ArchiveView_ArchiveView__N04WG",ArchiveList:"ArchiveView_ArchiveList__uL8b6",archiveButton:"ArchiveView_archiveButton__4UX3Q"}},2711:e=>{e.exports={error:"GlobalError_error__xWTQ7"}},3774:e=>{e.exports={Main:"UserLoginView_Main__shzii",headerStripes:"UserLoginView_headerStripes__9quCT",title:"UserLoginView_title__nXRqF",logo:"UserLoginView_logo__EqOOa"}},3905:()=>{},3911:e=>{e.exports={UserList:"UserList_UserList__17M_W",TableArea:"UserList_TableArea__p4Va_",Thead:"UserList_Thead__taPn2",Tr:"UserList_Tr__sPT1_",Th:"UserList_Th__j3c13"}},4622:e=>{e.exports={Modal:"Modal_Modal__mpQgM"}},4840:e=>{e.exports={Playground:"Playground_Playground__RMDje",buttons:"Playground_buttons__gz5h9",refresh:"Playground_refresh__84xa1"}},7014:e=>{e.exports={LoginForm:"Login_LoginForm__uHOu_"}},7737:e=>{e.exports={AdminConsole:"AdminConsole_AdminConsole__rASuW"}},7768:e=>{e.exports={OneHistory:"OneHistoryView_OneHistory__N_vm3",H1:"OneHistoryView_H1__zX2JW",H2:"OneHistoryView_H2__yg_Nc"}},8976:e=>{e.exports={RegisterLoginForm:"RegisterLoginForm_RegisterLoginForm__fPouy",registerBtn:"RegisterLoginForm_registerBtn__xymoa"}},9231:e=>{e.exports={Main:"ClubLoginView_Main__1VfWF",headerStripes:"ClubLoginView_headerStripes__d05kc",title:"ClubLoginView_title__CiXdd",logo:"ClubLoginView_logo__GPgKF"}},9458:e=>{e.exports={itemContent:"ListItem_itemContent__c2Zb8",userData:"ListItem_userData__liP5I",delBtn:"ListItem_delBtn___70mM",count:"ListItem_count__0Khk_"}}}]);